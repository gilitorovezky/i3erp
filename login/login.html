<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Y9 Construction</title>
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
		<link rel="stylesheet" href="../css/style-main.css" > 
		<link rel="icon" type="image/x-icon" href="../misc/y9-logo.ico">	
		<script type="text/javascript" src="../misc/cookies.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
	</head>
	<body>
		<div class="login">
			<div>
			<label style="font: 23px  black;font-style:italic">Welcome to Y9 Construction<label> 
			</div>
			<form action="" method="POST" onchange="return OnChange()" onsubmit="return OnSubmit()"> 
				<label for="username">
					<i class="fas fa-user"></i>
				</label>
				<input type="text" name="username" placeholder="Username" id="username" required>
				<label for="password">
					<i class="fas fa-lock"></i>
				</label>
				<input type="password" name="password" placeholder="Password" id="password" required>
				<p id ="loginResultID" class="login_error_msg"></p>
				<!--- <a id ="forgotPassword" class="labelFP">Forgot Password</a> -->
				<!--<div> -->
				<input type="submit" class="button boxShadow" value="Login">
				<!--</div> -->
			</form>
			<label style="font: 15px bold; color: rgba(7, 53, 239, 0.99); font-style: italic;">v2.3.2(Staging)</label>
		</div>
	<script>

	function OnChange() {
		document.getElementById("loginResultID").innerHTML = "";
	}

	function OnSubmit()	{

		let formData = new FormData();

		formData.append('username', document.getElementById("username").value);
		formData.append('password',document.getElementById("password").value);

		/*$.ajax({url     : "authenticate.php",
            method		: "POST",
            data      	: JSON.stringify({'username':document.getElementById("username").value},{'password':document.getElementById("password").value}),
            dataType	: "json",
            async       : false,  
            success		: function(data) {
				checkLogin(data);
            },
            error     	: (function (jqxhr, textStatus, error ) {
                windowLog.trace("Load estimates failed:"+textStatus + ", " + error); 
            })
        });*/

		fetch("authenticate.php", {
			method : "POST", 
			body: formData })
			.then(response  => response.json())
			.then((txt) 	=> {checkLogin(txt)}) // Print return message (success or failure)
			.catch(error 	=> {
				windowLog.trace('Error:', error);
				document.getElementById("loginResultID").innerHTML = "Error login in";
			return true;
		}); 
		return false;
	}

	function checkLogin(json) {

		if ( json.result > 0 ) {   //authentication pass
			window.location.replace("home.html#home"); // http://localhost:8080/login/home.html#home
			username = document.getElementById("username").value;  
    		fullname = document.getElementById("username").value;
			Cookies.set('username', document.getElementById("username").value, { expires: 365, path: '/' });
			Cookies.set('uid',json.uid);
		} else 
			document.getElementById("loginResultID").innerHTML = json.description;
	}

	</script>	
	</body>
</html>