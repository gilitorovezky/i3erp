<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* CRITICAL: The viewport must have a height and scroll set */
    
        .viewportDiv {
            height: 600px;
            overflow-y: auto;
            position: relative;
            border: 1px solid #ddd;
            width: 90%;
            margin: 0 auto;
        }

     
        td {
                border: 1px solid #ddd;
                padding: 8px;
                height: 20px;
                /* These lines handle long text so they don't push the column wide */
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
        }
       
        thead { 
                /*background: #f6d608; */
                color: rgb(232, 50, 50); 
                top: 0; 
        }

        thead th {
                position: sticky;
                background: #f6d608; 
                top: 0;
                /*background: #f8f8f8; /* Needs a solid background so rows don't show through */
                z-index: 2;          /* Keeps header above the spacer and rows */
                height: 20px;
                border-bottom: 2px solid #ccc;
        }

        .data-table {
                table-layout: fixed;
                width: 100%;
                border-collapse: collapse;
               
        }

        #search-bar {
                display: block;
                width: 10%;            /* Your requested width */
                min-width: 120px;      /* Prevents it from becoming unusable on small screens */
                margin-left: 10%;      /* Aligns it to the left edge of the 80% table */
                margin-bottom: 10px;   
                padding: 8px;
                box-sizing: border-box;
                border: 1px solid #ccc;
                border-radius: 4px;
        }

       .spacerDiv {
                position: absolute; 
                top         : 0; 
                left        : 0; 
                width           : 100%; 
                pointer-events  : none;
       } 
    </style>
</head>
<body>

    <input type="text" id="search-bar" placeholder="Type to search..." >

    <div id="viewport" class="viewportDiv">
       <div id="spacer" class="spacerDiv"></div> 
        
        <table class="data-table">
            <thead>
                <tr>
                    <th style="width: 15%;">ID</th>
                    <th style="width: 60%;">Product Name</th>
                    <th style="width: 25%;">Category</th>
                </tr>
            </thead>
            <tbody id="render-target">
                </tbody>
        </table>
    </div>

    <script>
        const rowHeight = 40;
        const visibleRows = 10;
        
        // 1. Setup Data
        const masterData = Array.from({ length: 1000 }, (_, i) => ({
            id: i + 1,
            name: "Product " + (i + 1),
            category: "Category " + (i % 5)
        }));
        let filteredData = [...masterData];

        const viewport = document.getElementById('viewport');
        const renderTarget = document.getElementById('render-target');
        const spacer = document.getElementById('spacer');

        function updateTable() {
            const count = filteredData.length;
            spacer.style.height = (count * rowHeight) + "px";

            const scrollTop = viewport.scrollTop;
            let startIndex = Math.floor(scrollTop / rowHeight);
            
            // Limit startIndex so we don't go off the end
            startIndex = Math.min(Math.max(0, startIndex), count - visibleRows);
            let endIndex = Math.min(count, startIndex + visibleRows + 5);

            const paddingTop = startIndex * rowHeight;
            const visibleSlice = filteredData.slice(startIndex, endIndex);

            // Using standard strings to avoid template literal issues in older browsers
            /*let html = '<tr style="height: ' + paddingTop + 'px;"><td colspan="3" style="border:none;"></td></tr>';
            
            for (let i = 0; i < visibleSlice.length; i++) {
                let item = visibleSlice[i];
                html += '<tr style="height: ' + rowHeight + 'px;">' +
                        '<td>' + item.id + '</td>' +
                        '<td>' + item.name + '</td>' +
                        '<td>' + item.category + '</td>' +
                        '</tr>';
            }

            renderTarget.innerHTML = html;*/

                // Build HTML string
            let html = '';

            // ONLY add the top spacer if we have actually scrolled down
            if (startIndex > 0) {
                const paddingTop = startIndex * rowHeight;
                html += '<tr style="height: ' + paddingTop + 'px;"><td colspan="3" style="border:none; padding:0;"></td></tr>';
            }

            // ACTUAL DATA ROWS
            html += visibleSlice.map(item => {
                return '<tr style="height: ' + rowHeight + 'px;">' +
                    '<td>' + item.id + '</td>' +
                    '<td>' + item.name + '</td>' +
                    '<td>' + item.category + '</td>' +
                    '</tr>';
            }).join('');

            // BOTTOM SPACER ROW
            const paddingBottom = Math.max(0, (count - endIndex) * rowHeight);
            if (paddingBottom > 0) {
                html += '<tr style="height: ' + paddingBottom + 'px;"><td colspan="3" style="border:none; padding:0;"></td></tr>';
            }

            renderTarget.innerHTML = html;
        }

        // Attach scroll event
        viewport.onscroll = updateTable;
        
        // Search logic
        document.getElementById('search-bar').oninput = function(e) {
            const term = e.target.value.toLowerCase();
            filteredData = masterData.filter(function(item) {
                return item.name.toLowerCase().indexOf(term) > -1;
            });
            viewport.scrollTop = 0;
            updateTable();
        };

        // Initial render
        updateTable();
    </script>
</body>
</html>